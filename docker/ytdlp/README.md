# YT-DLP Service

–°–µ—Ä–≤–∏—Å –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –≤–∏–¥–µ–æ —Å YouTube –∏ –¥—Ä—É–≥–∏—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º yt-dlp.

## üîß –ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ

**–î–∞—Ç–∞:** 23 –æ–∫—Ç—è–±—Ä—è 2025  
**–ò–∑–º–µ–Ω–µ–Ω–∏—è:**
- ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω yt-dlp –¥–æ –≤–µ—Ä—Å–∏–∏ 2024.10.22
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–±—Ö–æ–¥–∞ –±–ª–æ–∫–∏—Ä–æ–≤–æ–∫ YouTube
- ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω User-Agent –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç—ã
- ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ –æ—à–∏–±–∫–∞ HTTP 403 Forbidden

### –†–µ—à—ë–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

**–ü—Ä–æ–±–ª–µ–º–∞:** `ERROR: unable to download video data: HTTP Error 403: Forbidden`

**–†–µ—à–µ–Ω–∏–µ:**
1. –û–±–Ω–æ–≤–ª–µ–Ω–∞ –≤–µ—Ä—Å–∏—è yt-dlp (YouTube —Ä–µ–≥—É–ª—è—Ä–Ω–æ –º–µ–Ω—è–µ—Ç –∑–∞—â–∏—Ç—É)
2. –î–æ–±–∞–≤–ª–µ–Ω—ã –ø–∞—Ä–∞–º–µ—Ç—Ä—ã `extractor_args` —Å –∫–ª–∏–µ–Ω—Ç–æ–º iOS/web
3. –î–æ–±–∞–≤–ª–µ–Ω —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π User-Agent –±—Ä–∞—É–∑–µ—Ä–∞

## –í–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏

- üé• –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –≤–∏–¥–µ–æ –≤ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –∫–∞—á–µ—Å—Ç–≤–∞—Ö
- üéµ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∞—É–¥–∏–æ –≤ —Ñ–æ—Ä–º–∞—Ç–µ MP3
- üìù –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –≤–∏–¥–µ–æ –±–µ–∑ —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
- üìÑ –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—É–±—Ç–∏—Ç—Ä–æ–≤/—Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ç–æ–≤
- üåê REST API –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å n8n –∏ –¥—Ä—É–≥–∏–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏

## API Endpoints

### 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è —Å–µ—Ä–≤–∏—Å–∞

```bash
GET /health
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "status": "healthy",
  "service": "yt-dlp"
}
```

### 2. –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –≤–∏–¥–µ–æ

```bash
POST /info
Content-Type: application/json

{
  "url": "https://www.youtube.com/watch?v=VIDEO_ID"
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "title": "–ù–∞–∑–≤–∞–Ω–∏–µ –≤–∏–¥–µ–æ",
  "description": "–û–ø–∏—Å–∞–Ω–∏–µ",
  "duration": 300,
  "uploader": "–ê–≤—Ç–æ—Ä –∫–∞–Ω–∞–ª–∞",
  "upload_date": "20231015",
  "view_count": 1000000,
  "like_count": 50000,
  "thumbnail": "https://...",
  "formats": [...]
}
```

### 3. –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –≤–∏–¥–µ–æ/–∞—É–¥–∏–æ

```bash
POST /download
Content-Type: application/json

{
  "url": "https://www.youtube.com/watch?v=VIDEO_ID",
  "format": "video",  // "video", "audio", –∏–ª–∏ "best"
  "quality": "1080p"  // "best", "1080p", "720p", –∏ —Ç.–¥.
}
```

**–ü—Ä–∏–º–µ—Ä—ã:**

–°–∫–∞—á–∞—Ç—å –≤–∏–¥–µ–æ –≤ –ª—É—á—à–µ–º –∫–∞—á–µ—Å—Ç–≤–µ:
```json
{
  "url": "https://www.youtube.com/watch?v=VIDEO_ID",
  "format": "video",
  "quality": "best"
}
```

–°–∫–∞—á–∞—Ç—å —Ç–æ–ª—å–∫–æ –∞—É–¥–∏–æ –≤ MP3:
```json
{
  "url": "https://www.youtube.com/watch?v=VIDEO_ID",
  "format": "audio"
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "status": "success",
  "filename": "video_title.mp4",
  "path": "/downloads/video_title.mp4",
  "title": "–ù–∞–∑–≤–∞–Ω–∏–µ –≤–∏–¥–µ–æ"
}
```

### 4. –ü–æ–ª—É—á–µ–Ω–∏–µ —Å—É–±—Ç–∏—Ç—Ä–æ–≤

```bash
POST /download-transcript
Content-Type: application/json

{
  "url": "https://www.youtube.com/watch?v=VIDEO_ID",
  "lang": "en"  // –∫–æ–¥ —è–∑—ã–∫–∞ (en, ru, es, –∏ —Ç.–¥.)
}
```

**–û—Ç–≤–µ—Ç:**
```json
{
  "status": "success",
  "subtitles": {
    "manual": [...],
    "automatic": [...]
  },
  "title": "–ù–∞–∑–≤–∞–Ω–∏–µ –≤–∏–¥–µ–æ"
}
```

## –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ —Å n8n

1. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –Ω–æ–¥—É **HTTP Request** –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API
2. URL —Å–µ—Ä–≤–∏—Å–∞: `http://ytdlp:8081`
3. –ü—Ä–∏–º–µ—Ä—ã –∑–∞–ø—Ä–æ—Å–æ–≤ —Å–º. –≤—ã—à–µ

### –ü—Ä–∏–º–µ—Ä n8n workflow –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è –≤–∏–¥–µ–æ:

1. **Trigger** (–≤–µ–±—Ö—É–∫ –∏–ª–∏ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ)
2. **HTTP Request** –∫ `http://ytdlp:8081/info` –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏
3. **HTTP Request** –∫ `http://ytdlp:8081/download` –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è
4. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

## –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã

yt-dlp –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –±–æ–ª–µ–µ 1000 —Å–∞–π—Ç–æ–≤, –≤–∫–ª—é—á–∞—è:
- YouTube
- Vimeo
- Dailymotion
- Facebook
- Instagram
- Twitter
- TikTok
- –ò –º–Ω–æ–≥–∏–µ –¥—Ä—É–≥–∏–µ

–ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫: https://github.com/yt-dlp/yt-dlp/blob/master/supportedsites.md

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã —Å–µ—Ä–≤–∏—Å–∞:

```bash
# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è
curl http://localhost:8081/health

# –ü–æ–ª—É—á–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –≤–∏–¥–µ–æ
curl -X POST http://localhost:8081/info \
  -H "Content-Type: application/json" \
  -d '{"url": "https://www.youtube.com/watch?v=dQw4w9WgXcQ"}'

# –°–∫–∞—á–∏–≤–∞–Ω–∏–µ –∞—É–¥–∏–æ
curl -X POST http://localhost:8081/download \
  -H "Content-Type: application/json" \
  -d '{"url": "https://www.youtube.com/watch?v=dQw4w9WgXcQ", "format": "audio"}'
```

## Volumes

- `/downloads` - –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–∫–∞—á–∞–Ω–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤
- `/root/.cache` - –∫—ç—à yt-dlp

## –ü–æ—Ä—Ç—ã

- `8081` - HTTP API —Å–µ—Ä–≤–µ—Ä

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

- `PYTHONUNBUFFERED=1` - –≤—ã–≤–æ–¥ –ª–æ–≥–æ–≤ Python –±–µ–∑ –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏–∏
